<!DOCTYPE html>



 <html class="no-js" lang="en"> 
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">

	<title>a flash of light and a distant boom: Serving your resume over curl like a badass: Running a wopr server on an EC2 instance with Docker</title>

	<link rel="canonical" href="http://blog.soulshake.net/2016/04/command-line-resume/">
	

	
<meta property="twitter:account_id" content="285428413" />
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@s0ulshake">
<meta name="twitter:creator" content="@s0ulshake">
<meta name="twitter:title" content="a flash of light and a distant boom: Serving your resume over curl like a badass: Running a wopr server on an EC2 instance with Docker">
<meta name="twitter:description" content="">
<meta name="twitter:image:src" content="/img/share.png">
<meta name="twitter:image:width" content="500">
<meta name="twitter:image:height" content="500">
<meta name="twitter:domain" content="blog.soulshake.net">


<meta property="og:title" content="Serving your resume over curl like a badass: Running a wopr server on an EC2 instance with Docker"/>
<meta property="og:Section" content="website"/>
<meta property="og:url" content="http://blog.soulshake.net/2016/04/command-line-resume/"/>
<meta property="og:image" content="/img/share.png"/>
<meta property="og:site_name" content="a flash of light and a distant boom"/>
<meta property="fb:admins" content="1018260045"/>
<meta property="og:description" content=""/>


	<link rel="shortcut icon" href="http://blog.soulshake.net/favicon.ico">

	<link rel="stylesheet" href="http://blog.soulshake.net/css/main.css" />
	<script src="http://blog.soulshake.net/js/lib/modernizr-2.6.2.min.js"></script>
</head>
<body onload="doPrettyPrint()">

<header>
	<nav>
		<ul class="main">
			<li><a href="https://blog.soulshake.net">a flash of light and a distant boom</a></li>
		</ul>
		<ul class="social">
			
			<li>
				<a class="fa fa-github" href="https://github.com/soulshake" target="_blank"></a>
			</li>
			<li>
				<a class="fa fa-twitter" href="https://twitter.com/s0ulshake" target="_blank"></a>
			</li>
		</ul>
	</nav>
</header>



<div class="container single">
	<article>
		<h2>Serving your resume over curl like a badass: Running a wopr server on an EC2 instance with Docker</h2>
		<div class="time">Sunday, April 3, 2016</div>
		

<h2 id="requirements:6bc6e46e56683b9c46ddae56b95e1d9f">Requirements</h2>

<ul>
<li>Docker (<a href="https://docs.docker.com/engine/installation/">how to install</a>)</li>
<li>Docker Machine (<a href="https://docs.docker.com/machine/install-machine/">how to install</a>)</li>
<li>the AWS CLI (<a href="https://docs.aws.amazon.com/cli/latest/userguide/installing.html">how to install</a>)</li>
<li>An AWS account</li>
</ul>

<h3 id="optional:6bc6e46e56683b9c46ddae56b95e1d9f">Optional</h3>

<ul>
<li>A domain name</li>
</ul>

<h2 id="how-to:6bc6e46e56683b9c46ddae56b95e1d9f">How to</h2>

<p>Clone this repo:</p>

<pre><code>$ git clone https://github.com/soulshake/cv.soulshake.net.git
</code></pre>

<p>Export AWS environment variables:</p>

<pre><code class="language-bash">export AWS_SECRET_ACCESS_KEY=your-key-here
export AWS_ACCESS_KEY_ID=your-key-id-here
export AWS_DEFAULT_REGION=your-aws-region-here
</code></pre>

<p>By default, <code>machine</code> creates new instances in region <code>us-east-1</code>.</p>

<h3 id="use-docker-machine-to-create-a-host-ec2-instance:6bc6e46e56683b9c46ddae56b95e1d9f">Use docker-machine to create a host EC2 instance</h3>

<pre><code>$ docker-machine create --driver amazonec2 aws-sandbox

$ eval $(docker-machine env aws-sandbox)

$ docker build -t soulshake/cv.soulshake.net .
</code></pre>

<h3 id="create-a-cname:6bc6e46e56683b9c46ddae56b95e1d9f">create a CNAME</h3>

<h4 id="get-your-ec2-instance-public-dns-name:6bc6e46e56683b9c46ddae56b95e1d9f">Get your EC2 instance public DNS name</h4>

<pre><code class="language-bash">aws ec2 describe-instances \
    --query  &quot;Reservations[*].Instances[*].[{CNAME:PublicDnsName,SecurityGroups:SecurityGroups}]&quot; \
    --output table
</code></pre>

<h4 id="and-create-a-cname-record-with-your-domain-provider:6bc6e46e56683b9c46ddae56b95e1d9f">And create a CNAME record with your domain provider</h4>

<pre><code class="language-bash">gandi record create \
    --name cv \
    --type CNAME \
    --value ec2-52-58-37-111.eu-central-1.compute.amazonaws.com. \
    soulshake.net
</code></pre>

<h2 id="add-docker-machine-to-security-group:6bc6e46e56683b9c46ddae56b95e1d9f">add docker-machine to security group</h2>

<p>You have two ways to do this:</p>

<h3 id="on-the-command-line:6bc6e46e56683b9c46ddae56b95e1d9f">On the command line</h3>

<pre><code class="language-bash">aws ec2 describe-security-groups \
    --filters &quot;Name=group-name,Values=docker-machine&quot; \
    --output table

</code></pre>

<h3 id="on-the-web-interface:6bc6e46e56683b9c46ddae56b95e1d9f">On the web interface</h3>

<p>Log into the <a href="https://eu-central-1.console.aws.amazon.com/ec2/v2/home?region=eu-central-1#Instances:sort=publicIp">EC2 console</a> (make sure to select your region at the top right), then:</p>

<pre><code>- By &quot;Security groups&quot; click the &quot;docker-machine&quot; link
- When the security group is selected, select the &quot;Inbound&quot; tab at the bottom
- Click the &quot;Edit&quot; button
- Click &quot;Add Rule&quot; --&gt; All traffic --&gt; All [protocol] --&gt; Source: Anywhere 0.0.0.0/0 --&gt; Save
</code></pre>

<h2 id="run-the-container:6bc6e46e56683b9c46ddae56b95e1d9f">Run the container</h2>

<pre><code class="language-bash">docker run -d -ti \
    --name cv.soulshake.net \
    --publish-all \
    -p 80:1337 \
    -p 1337:1337  \
    soulshake/cv.soulshake.net

</code></pre>

<h3 id="behold-the-magic:6bc6e46e56683b9c46ddae56b95e1d9f">Behold the magic!</h3>

<pre><code class="language-bash">curl -N cv.soulshake.net:32769/\[0-2\]\?auto\&amp;cols=$((COLUMNS))&amp;rows=$((LINES))&amp;terminal=${TERM}

curl -N cv.soulshake.net:32769/\[0-2\]\?cols=$((COLUMNS))&amp;rows=$((ROWS))
</code></pre>

<h1 id="automated-building:6bc6e46e56683b9c46ddae56b95e1d9f">Automated building</h1>

<p>If you want to take it to the next level, you can set up hooks.</p>

<h2 id="automated-docker-hub-builds:6bc6e46e56683b9c46ddae56b95e1d9f">Automated Docker hub builds</h2>

<p>Log into your <a href="https://hub.docker.com">Docker Hub</a> account and create a new Automated Build that will be triggered every time you push to your GitHub or BitBucket repo.</p>

<h2 id="automated-deployment-of-the-newly-built-container-on-your-ec2-instance:6bc6e46e56683b9c46ddae56b95e1d9f">Automated deployment of the newly built container on your EC2 instance</h2>

<p>Then, using <a href="https://github.com/ehazlett/conduit">conduit</a>, you can set up your EC2 instance so the build triggers a new container to push your changes to production.</p>

<p>That command will look something like this:</p>

<pre><code class="language-bash">docker run -d \
    --name conduit \
    -p 8080:8080 \
    -v /var/run/docker.sock:/var/run/docker.sock \
    ehazlett/conduit \
    -r soulshake/cv.soulshake.net \
    -t YOUR_TOKEN_HERE

</code></pre>

	</article>
</div>

	<footer>&copy; AJ Bowen 2016
		<a class="pull-right" href="https://twitter.com/s0ulshake" target="_blank">@s0ulshake</a>
	</footer>

	<script src="http://blog.soulshake.net/js/prettify/prettify.js"></script>

    <script>
        function doPrettyPrint(){
            pres=document.getElementsByTagName('pre');
            for (i=0; i < pres.length; i++) {
                pres[i].className+=" prettyprint";
            }
            prettyPrint();
        }
    </script>
	
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-75793986-1', 'auto');
      ga('send', 'pageview');

	</script>

</body>
</html>

